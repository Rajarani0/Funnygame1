<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUND BATTLE - Secure</title>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body { font-family: 'Press Start 2P', system-ui; }
        .neon-red { text-shadow: 0 0 10px #ef4444, 0 0 20px #ef4444; }
        .neon-green { text-shadow: 0 0 10px #22c55e, 0 0 20px #22c55e; }
    </style>
</head>
<body class="bg-zinc-950 text-white min-h-screen">

<header class="border-b border-zinc-800 bg-black py-4">
    <div class="max-w-7xl mx-auto px-8 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-green-500 rounded-xl flex items-center justify-center text-3xl">‚öîÔ∏è</div>
            <h1 class="text-3xl font-bold tracking-widest neon-red">FUND BATTLE</h1>
            <p class="text-xs text-emerald-400">Secure ‚Ä¢ Email Login ‚Ä¢ No Blockchain</p>
        </div>
        <div class="flex items-center gap-6">
            <button onclick="showLoginModal()" id="loginBtn" class="bg-white text-black px-6 py-3 rounded-2xl font-bold">LOGIN / REGISTER</button>
            <button onclick="showAdminModal()" id="adminBtn" class="hidden bg-yellow-500 hover:bg-yellow-600 text-black px-6 py-3 rounded-2xl font-bold">ADMIN PANEL</button>
        </div>
    </div>
</header>

<div class="max-w-7xl mx-auto flex">
    <!-- Sidebar -->
    <div class="w-80 bg-zinc-900 p-6 border-r border-zinc-800">
        <div class="bg-zinc-800 rounded-3xl p-6">
            <p class="text-xs text-zinc-400 mb-2">YOUR BALANCE</p>
            <p id="userBalance" class="text-5xl font-bold text-emerald-400">0</p>
            <button onclick="requestFunds()" class="mt-6 w-full bg-gradient-to-r from-yellow-500 to-amber-500 text-black font-bold py-4 rounded-2xl">ADMIN SE 10,000 FUND LENA</button>
        </div>
    </div>

    <!-- Main Game -->
    <div class="flex-1 p-8">
        <div class="max-w-2xl mx-auto">
            <!-- Timer -->
            <div class="text-center mb-10">
                <div class="inline-flex bg-black px-12 py-5 rounded-3xl border border-orange-500 items-center gap-4">
                    <i class="fa-solid fa-clock text-3xl text-orange-400"></i>
                    <div>
                        <p class="text-xs text-orange-400">NEXT ROUND IN</p>
                        <p id="timer" class="text-6xl font-bold text-white">60</p>
                    </div>
                </div>
            </div>

            <!-- Pools -->
            <div class="bg-zinc-900 rounded-3xl p-8 mb-10">
                <div class="flex justify-between mb-3">
                    <div class="flex items-center gap-3"><div class="w-6 h-6 bg-red-500 rounded-full"></div><span class="font-bold text-xl">RED</span></div>
                    <span id="redPool" class="text-4xl font-mono text-red-400">0</span>
                </div>
                <div class="h-8 bg-zinc-800 rounded-full overflow-hidden flex">
                    <div id="redBar" class="h-full bg-red-500 transition-all" style="width:50%"></div>
                    <div id="greenBar" class="h-full bg-green-500 transition-all" style="width:50%"></div>
                </div>
                <div class="flex justify-between mt-3">
                    <div class="flex items-center gap-3"><div class="w-6 h-6 bg-green-500 rounded-full"></div><span class="font-bold text-xl">GREEN</span></div>
                    <span id="greenPool" class="text-4xl font-mono text-green-400">0</span>
                </div>
            </div>

            <!-- Bet -->
            <div class="bg-zinc-900 rounded-3xl p-8">
                <input id="betAmount" type="number" placeholder="BET AMOUNT" class="w-full text-center text-4xl bg-transparent border-b border-zinc-700 py-6 outline-none">
                <div class="grid grid-cols-2 gap-6 mt-10">
                    <button onclick="placeBet('red')" class="bg-red-600 hover:bg-red-700 h-32 rounded-3xl text-3xl font-bold">üî¥ RED</button>
                    <button onclick="placeBet('green')" class="bg-green-600 hover:bg-green-700 h-32 rounded-3xl text-3xl font-bold">üü¢ GREEN</button>
                </div>
            </div>

            <div id="result" class="hidden mt-8 p-8 bg-black/80 border border-emerald-500 rounded-3xl text-center text-4xl"></div>
        </div>
    </div>

    <!-- History -->
    <div class="w-96 bg-zinc-900 p-6 border-l border-zinc-800">
        <p class="uppercase text-xs mb-4 text-zinc-400">LAST 5 RESULTS</p>
        <div id="history" class="space-y-4"></div>
    </div>
</div>

<!-- Login Modal -->
<div id="loginModal" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center z-50">
    <div class="bg-zinc-900 w-96 p-8 rounded-3xl">
        <h2 class="text-2xl mb-6 text-center">Email Login / Register</h2>
        <input id="email" type="email" placeholder="your@email.com" class="w-full p-4 rounded-2xl bg-zinc-800 mb-4">
        <input id="password" type="password" placeholder="Password (minimum 6 characters)" class="w-full p-4 rounded-2xl bg-zinc-800 mb-6">
        <button onclick="handleLogin()" class="w-full bg-emerald-500 py-4 rounded-2xl font-bold text-xl">LOGIN / REGISTER</button>
        <button onclick="hideLoginModal()" class="mt-4 w-full text-zinc-400">Cancel</button>
    </div>
</div>

<!-- Admin Modal -->
<div id="adminModal" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center z-50">
    <div class="bg-zinc-900 w-[480px] p-8 rounded-3xl">
        <h2 class="text-2xl mb-6">üîí ADMIN PANEL (Only You)</h2>
        <input id="targetEmail" placeholder="User ka email" class="w-full p-4 bg-zinc-800 rounded-2xl mb-4">
        <input id="transferAmount" type="number" placeholder="Amount to send" class="w-full p-4 bg-zinc-800 rounded-2xl mb-6">
        <button onclick="adminTransfer()" class="w-full bg-yellow-500 text-black py-4 rounded-2xl font-bold">SEND FUND</button>
        <button onclick="hideAdminModal()" class="mt-4 w-full text-zinc-400">Close</button>
    </div>
</div>

<script>
// ================== üî• TUMHARA CONFIG YAHAN PASTE KARO ==================
const firebaseConfig = {
    apiKey: "AIzaSyD0pnfpgTxPNbeXiBNfToylZ1RGqfcx4S4",
    authDomain: "funnygame-88c09.firebaseapp.com",
    projectId: "funnygame-88c09",
    storageBucket: "funnygame-88c09.firebasestorage.app",
    messagingSenderId: "1019809113252",
    appId: "1:1019809113252:web:44efd0c5ab46f538323231"
};
// =====================================================================

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const ADMIN_EMAIL = "shreeniv1234@gmail.com";   // ‚Üê‚Üê‚Üê APNA ADMIN EMAIL YAHAN DAAL DO

let currentUser = null;
let timeLeft = 60;
let timerInterval = null;

// Real-time listeners
function setupListeners() {
    // User balance listener
    db.collection("users").doc(currentUser.uid).onSnapshot(doc => {
        if (doc.exists) {
            const data = doc.data();
            document.getElementById("userBalance").innerText = (data.balance || 0).toLocaleString('en-IN');
        }
    });

    // Game state listener (pools + timer)
    db.collection("game").doc("current").onSnapshot(doc => {
        if (doc.exists) {
            const g = doc.data();
            document.getElementById("redPool").innerText = Math.floor(g.redPool || 0);
            document.getElementById("greenPool").innerText = Math.floor(g.greenPool || 0);
            
            const total = (g.redPool || 0) + (g.greenPool || 0) || 1;
            document.getElementById("redBar").style.width = `${(g.redPool || 0)/total*100}%`;
            document.getElementById("greenBar").style.width = `${(g.greenPool || 0)/total*100}%`;
            
            // Timer sync
            if (g.roundEndTime) {
                const endTime = g.roundEndTime.toDate ? g.roundEndTime.toDate().getTime() : Date.now() + 60000;
                startSyncedTimer(endTime);
            }
        }
    });
}

async function handleLogin() {
    const email = document.getElementById("email").value.trim();
    const pass = document.getElementById("password").value;

    try {
        let userCred;
        try {
            userCred = await auth.signInWithEmailAndPassword(email, pass);
        } catch (e) {
            userCred = await auth.createUserWithEmailAndPassword(email, pass);
        }

        currentUser = userCred.user;
        hideLoginModal();
        document.getElementById("loginBtn").classList.add("hidden");

        // Create user document
        await db.collection("users").doc(currentUser.uid).set({
            email: email,
            balance: 500,
            betRed: 0,
            betGreen: 0,
            lastRound: 0
        }, { merge: true });

        setupListeners();

        if (email === ADMIN_EMAIL) {
            document.getElementById("adminBtn").classList.remove("hidden");
        }

        alert(`‚úÖ Welcome ${email}! Game shuru ho gaya`);
        initGame();   // first round start
    } catch (err) {
        alert("Error: " + err.message);
    }
}

function showLoginModal() { document.getElementById("loginModal").classList.remove("hidden"); }
function hideLoginModal() { document.getElementById("loginModal").classList.add("hidden"); }
function showAdminModal() { document.getElementById("adminModal").classList.remove("hidden"); }
function hideAdminModal() { document.getElementById("adminModal").classList.add("hidden"); }

// Request 10,000 from admin (admin fund infinite for demo)
async function requestFunds() {
    if (!currentUser) return alert("Pehle login karo");
    const userRef = db.collection("users").doc(currentUser.uid);
    await userRef.update({ balance: firebase.firestore.FieldValue.increment(10000) });
    alert("‚úÖ 10,000 fund mil gaye!");
}

// Place bet
async function placeBet(color) {
    if (!currentUser) return alert("Login karo pehle");
    let amount = parseFloat(document.getElementById("betAmount").value);
    if (!amount || amount <= 0) return alert("Amount daalo");

    const userRef = db.collection("users").doc(currentUser.uid);
    const gameRef = db.collection("game").doc("current");

    try {
        await db.runTransaction(async (t) => {
            const userSnap = await t.get(userRef);
            const gameSnap = await t.get(gameRef);
            const bal = userSnap.data().balance || 0;

            if (bal < amount) throw "Balance kam hai";

            t.update(userRef, { 
                balance: firebase.firestore.FieldValue.increment(-amount),
                [`bet${color.charAt(0).toUpperCase() + color.slice(1)}`]: firebase.firestore.FieldValue.increment(amount)
            });

            t.update(gameRef, { 
                [`${color}Pool`]: firebase.firestore.FieldValue.increment(amount) 
            });
        });
        alert(`‚úÖ ${amount} bet ${color.toUpperCase()} pe lag gaya`);
    } catch (e) {
        alert(e);
    }
}

// Admin transfer
async function adminTransfer() {
    if (!currentUser || currentUser.email !== ADMIN_EMAIL) return alert("Sirf admin hi kar sakta hai");

    const targetEmail = document.getElementById("targetEmail").value.trim();
    const amount = parseInt(document.getElementById("transferAmount").value);

    if (!targetEmail || !amount) return alert("Email aur amount daalo");

    const snap = await db.collection("users").where("email", "==", targetEmail).get();
    if (snap.empty) return alert("User nahi mila");

    await snap.docs[0].ref.update({ balance: firebase.firestore.FieldValue.increment(amount) });
    alert(`‚úÖ ${amount} fund bhej diya!`);
    hideAdminModal();
}

// Timer sync
function startSyncedTimer(endTimestamp) {
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        const now = Date.now();
        timeLeft = Math.max(0, Math.ceil((endTimestamp - now) / 1000));
        document.getElementById("timer").innerText = timeLeft;

        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            endRound();
        }
    }, 1000);
}

// End round logic
async function endRound() {
    const gameRef = db.collection("game").doc("current");
    try {
        await db.runTransaction(async (t) => {
            const g = (await t.get(gameRef)).data();
            if (!g.isBettingOpen) return;

            let winner = (g.redPool || 0) <= (g.greenPool || 0) ? "red" : "green";

            t.update(gameRef, {
                isBettingOpen: false,
                lastWinner: winner,
                redPool: 0,
                greenPool: 0,
                roundEndTime: firebase.firestore.Timestamp.fromDate(new Date(Date.now() + 60000))
            });

            // Current user payout (other users next load pe mil jayega)
            if (currentUser) {
                const userRef = db.collection("users").doc(currentUser.uid);
                const u = (await t.get(userRef)).data();
                const bet = winner === "red" ? (u.betRed || 0) : (u.betGreen || 0);
                if (bet > 0) {
                    t.update(userRef, {
                        balance: firebase.firestore.FieldValue.increment(bet * 2),
                        betRed: 0,
                        betGreen: 0
                    });
                }
            }
        });

        // Show result
        const res = document.getElementById("result");
        res.innerHTML = winner === "red" ? 
            `<span class="neon-red">üî¥ RED WINS!</span><br>Double payout ho gaya` : 
            `<span class="neon-green">üü¢ GREEN WINS!</span><br>Double payout ho gaya`;
        res.classList.remove("hidden");

        setTimeout(() => res.classList.add("hidden"), 6000);
    } catch (e) { console.log(e); }
}

// First round create
async function initGame() {
    const gameRef = db.collection("game").doc("current");
    const snap = await gameRef.get();
    if (!snap.exists) {
        await gameRef.set({
            redPool: 0,
            greenPool: 0,
            isBettingOpen: true,
            lastWinner: "",
            roundEndTime: firebase.firestore.Timestamp.fromDate(new Date(Date.now() + 60000))
        });
    }
}

// Auto login check
window.onload = () => {
    auth.onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            document.getElementById("loginBtn").classList.add("hidden");
            setupListeners();
            initGame();
            if (user.email === ADMIN_EMAIL) document.getElementById("adminBtn").classList.remove("hidden");
        }
    });
};
</script>
</body>
</html>